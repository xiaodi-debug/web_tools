import{d as V,b as r,e as s,g as k,_ as $,t as _,h as S,s as U,F as P,j as C,n as L,p as c,q as A,E as G,f as z,r as p,c as x,o as H,D as J,u as O,A as u,C as W}from"./index-BwwhmSGQ.js";import{r as N}from"./request-C7OBr44B.js";const X={class:"header"},Y={class:"row1"},Z={class:"title"},K={class:"title-ico"},ee={class:"q"},ae={class:"search-pill"},te=["value","placeholder"],se={class:"btn",type:"submit"},le={class:"tabs seg",role:"tablist","aria-label":"搜索分类"},oe=["disabled","onClick"],ne=V({__name:"MusicSearchPageHeader",props:{query:{},modelValue:{},activeTab:{},tabs:{},placeholder:{}},emits:["update:modelValue","search","changeTab"],setup(a,{emit:t}){const y=t;function b(){y("search")}return(v,o)=>(c(),r("div",X,[s("div",Y,[s("div",Z,[s("span",K,[k($,{name:"ri-music-2-line",size:18})]),o[1]||(o[1]=s("span",{class:"t"},"音乐搜索",-1)),s("span",ee,_(a.query||a.modelValue),1)]),s("form",{class:"search",onSubmit:S(b,["prevent"])},[s("div",ae,[k($,{name:"ri-search-line",class:"ico"}),s("input",{class:"ipt",value:a.modelValue,placeholder:a.placeholder||"搜索歌手、歌曲或专辑名",onInput:o[0]||(o[0]=l=>y("update:modelValue",l.target.value))},null,40,te),s("button",se,[k($,{name:"ri-search-line",size:16}),o[2]||(o[2]=U(" 搜索 ",-1))])])],32)]),s("div",le,[(c(!0),r(P,null,C(a.tabs,l=>(c(),r("button",{key:l.key,class:L(["tab seg-btn",{active:l.key===a.activeTab}]),type:"button",role:"tab",disabled:l.disabled,onClick:n=>y("changeTab",l.key)},_(l.label),11,oe))),128))])]))}}),ie=A(ne,[["__scopeId","data-v-d3d5bf71"]]),re={class:"wrap"},ce={key:0,class:"alert alert-danger mb-0",role:"alert"},de={key:1,class:"tbody"},ue={key:0,class:"empty"},ve={key:1,class:"empty"},ye={class:"c idx"},me={class:"c song songcell"},he={class:"name text-truncate"},pe={class:"c artist text-truncate"},_e={class:"c album text-truncate"},be={class:"c dur"},ge={class:"c act"},fe=["onClick"],ke=["onClick"],we=["href","download"],$e=V({__name:"MusicSongTable",props:{list:{},loading:{type:Boolean},errorMsg:{}},emits:["play","add"],setup(a,{emit:t}){const y=t;function b(o){const l=[];return o.sq&&l.push("SQ"),o.hq&&l.push("HQ"),l.length?l:o.qualities||[]}function v(o){if(typeof o!="number"||!Number.isFinite(o)||o<=0)return"--:--";const l=Math.floor(o),n=Math.floor(l/60),g=l%60;return`${String(n).padStart(2,"0")}:${String(g).padStart(2,"0")}`}return(o,l)=>(c(),r("div",re,[l[1]||(l[1]=G('<div class="thead" data-v-2d358006><div class="c idx" data-v-2d358006>#</div><div class="c song" data-v-2d358006>歌曲</div><div class="c artist" data-v-2d358006>歌手</div><div class="c album" data-v-2d358006>专辑</div><div class="c dur" data-v-2d358006>时长</div><div class="c act" data-v-2d358006>操作</div></div>',1)),a.errorMsg?(c(),r("div",ce,_(a.errorMsg),1)):(c(),r("div",de,[a.loading?(c(),r("div",ue,"加载中...")):a.list.length?z("",!0):(c(),r("div",ve,"暂无数据")),(c(!0),r(P,null,C(a.list,(n,g)=>(c(),r("div",{key:n.id,class:"tr"},[s("div",ye,_(String(g+1).padStart(2,"0")),1),s("div",me,[s("span",he,_(n.name),1),(c(!0),r(P,null,C(b(n),m=>(c(),r("span",{key:m,class:L(["tag",m.toLowerCase()])},_(m),3))),128))]),s("div",pe,_(n.artist),1),s("div",_e,_(n.album||"-"),1),s("div",be,_(v(n.duration)),1),s("div",ge,[s("button",{type:"button",class:"icon-btn",title:"播放",onClick:S(m=>y("play",n),["stop"])},[k($,{name:"ri-play-circle-line",class:"play"})],8,fe),s("button",{type:"button",class:"icon-btn",title:"加入播放列表",onClick:S(m=>y("add",n),["stop"])},[k($,{name:"ri-add-circle-line",class:"add"})],8,ke),s("a",{class:"icon-btn",title:"下载",href:n.url,download:`${n.name}.mp3`,target:"_blank",rel:"noreferrer",onClick:l[0]||(l[0]=S(()=>{},["stop"]))},[k($,{name:"ri-download-2-line",class:"dl"})],8,we)])]))),128))]))]))}}),Me=A($e,[["__scopeId","data-v-2d358006"]]);async function Se(a){return N({url:"/music/search",method:"get",params:a})}async function xe(){return N({url:"/music/hot",method:"get"})}const T=a=>({title:a.name,artist:a.artist,src:a.url,pic:a.cover}),I=a=>({title:a.name,artist:a.artist,url:a.url,cover:a.cover});function qe(){const a=p(""),t=p(1),y=p(15),b=p(0),v=p([]),o=p([]),l=p(!1),n=p(!1),g=p(null),m=p(0),M=x(()=>v.value.length<b.value),e=p([]),d=p(null),w=i=>{e.value.some(f=>f.src===i.src&&f.title===i.title&&f.artist===i.artist)||(e.value=[...e.value,i])},B=i=>{const h=T(i);w(h),d.value=h;try{window.$miniPlayer?.play(I(i)),window.$miniPlayer?.show()}catch{}},Q=i=>{const h=T(i);w(h);try{window.$miniPlayer?.add(I(i),!1),window.$miniPlayer?.show()}catch{}},D=i=>{const h=T(i);w(h),d.value=h},F=()=>{e.value=[],d.value=null},q=async(i=!1)=>{if(l.value||!i&&!M.value&&v.value.length>0)return;const h=++m.value;g.value=null,i?(l.value=!0,t.value=1):(n.value=!0,t.value+=1);try{const f=await Se({keyword:a.value.trim()||void 0,page:t.value,pageSize:y.value});if(h!==m.value)return;b.value=f.data.total,t.value=f.data.page,y.value=f.data.pageSize,i?v.value=f.data.list:v.value=[...v.value,...f.data.list]}catch{h===m.value&&(g.value="加载失败，请稍后重试")}finally{h===m.value&&(l.value=!1,n.value=!1)}},E=async i=>{typeof i=="string"&&(a.value=i),await q(!0)},R=async()=>{await q(!1)},j=async()=>{const i=await xe();o.value=i.data.list};return H(async()=>{await Promise.all([j(),q(!0)])}),{keyword:a,list:v,hotList:o,total:b,loading:l,loadingMore:n,errorMsg:g,hasMore:M,playlist:e,currentMusic:d,onSearch:E,onLoadMore:R,playItem:B,addToPlaylist:Q,playHot:D,clearPlaylist:F}}const Te={class:"container-fluid py-3 portal-page"},Pe={class:"top-card"},Ce={class:"summary-row"},Ve={class:"summary-left"},Ae={class:"summary-right"},Ie={key:0,class:"text-secondary small"},Le={class:"row g-3 mt-1 pb-player"},ze={class:"col-12"},He={class:"load-more"},Ne=["disabled"],Be={key:1,class:"text-secondary small"},Qe=V({__name:"index",setup(a){const t=qe(),y=J(),b=W(),v=x(()=>{const e=y.query.tab;return typeof e=="string"?e:Array.isArray(e)&&typeof e[0]=="string"?e[0]:"song"}),o=[{key:"all",label:"综合",disabled:!0},{key:"song",label:"歌曲"},{key:"artist",label:"音乐人",disabled:!0},{key:"album",label:"专辑",disabled:!0},{key:"playlist",label:"歌单",disabled:!0}],l=x(()=>`找到 ${t.total.value.toLocaleString()} 条结果`),n=x(()=>{const e=y.query.q;return typeof e=="string"?e:Array.isArray(e)&&typeof e[0]=="string"?e[0]:""}),g=async()=>{const e=n.value.trim();e&&e!==t.keyword.value&&await t.onSearch(e)},m=async()=>{const e=t.keyword.value.trim();b.replace({path:"/music/search",query:{...e?{q:e}:void 0,...v.value?{tab:v.value}:void 0}}),await t.onSearch(e)},M=async e=>{const d=t.keyword.value.trim();b.replace({path:"/music/search",query:{...d?{q:d}:void 0,...e?{tab:e}:void 0}})};return O(()=>n.value,async()=>{await g()}),H(async()=>{await g()}),(e,d)=>(c(),r("div",Te,[s("div",Pe,[k(ie,{query:n.value,modelValue:u(t).keyword.value,"onUpdate:modelValue":d[0]||(d[0]=w=>u(t).keyword.value=w),activeTab:v.value,tabs:o,onSearch:m,onChangeTab:M},null,8,["query","modelValue","activeTab"])]),d[2]||(d[2]=s("div",{class:"divider"},null,-1)),s("div",Ce,[s("div",Ve,_(l.value),1),s("div",Ae,[u(t).loading.value?(c(),r("span",Ie,"加载中...")):z("",!0)])]),s("div",Le,[s("div",ze,[k(Me,{list:u(t).list.value,loading:u(t).loading.value,errorMsg:u(t).errorMsg.value,onPlay:u(t).playItem,onAdd:u(t).addToPlaylist},null,8,["list","loading","errorMsg","onPlay","onAdd"]),s("div",He,[u(t).hasMore.value?(c(),r("button",{key:0,class:"btn btn-outline-secondary",type:"button",disabled:u(t).loading.value||u(t).loadingMore.value,onClick:d[1]||(d[1]=(...w)=>u(t).onLoadMore&&u(t).onLoadMore(...w))},_(u(t).loadingMore.value?"加载中...":"加载更多"),9,Ne)):(c(),r("span",Be,"没有更多了"))])])])]))}}),Ee=A(Qe,[["__scopeId","data-v-557b68ba"]]);export{Ee as default};
