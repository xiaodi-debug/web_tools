import{d as q,c as p,D as A,r as m,u as K,b as i,e as t,f as u,g,s as h,_,t as v,F as y,j as f,C as P,l as $,k as W,m as Y,n as H,x as Q,p as a,q as X}from"./index-BwwhmSGQ.js";import{f as R}from"./wallpaper-VN99naTl.js";import"./request-C7OBr44B.js";const Z={class:"detail"},tt={class:"container-fluid py-3 detail-shell portal-page"},et={class:"d-flex align-items-center gap-2 mb-3"},st={key:0,class:"text-secondary small"},lt={key:0,class:"row g-4"},at={class:"col-12 col-lg-7"},ot={class:"preview"},it=["src","alt"],nt={class:"section mt-4"},ct={key:0,class:"tag-row"},rt={key:1,class:"text-secondary small"},dt={class:"col-12 col-lg-5"},ut={class:"info-card portal-card portal-card-pad"},vt={class:"info-top"},mt={class:"info-title"},_t={class:"info-sub text-secondary small"},pt={class:"actions"},gt={class:"section mt-4"},ht={key:0,class:"text-secondary small"},yt={key:1,class:"rec-grid"},ft=["src","alt"],kt={key:2,class:"text-secondary small"},bt={key:1,class:"section mt-4"},wt={class:"collection-grid"},xt={class:"collage"},Ct=["src","alt"],St={key:0,class:"collage-empty text-secondary small"},zt={class:"collage-avatar","aria-hidden":"true"},$t={class:"collage-title"},Rt={key:2,class:"text-secondary"},U="wallpaper_detail_item",Ut=q({__name:"index",setup(Nt){const N=A(),C=P(),k=p(()=>String(N.params.id||"")),s=m(null),b=m(new Set),w=m(!1),B=(o,l)=>`${o}×${l}`,F=(o,l)=>`${(o*l*3/1024/1024).toFixed(1)}MB`,I=async()=>{const o=window.sessionStorage.getItem(U);if(o)try{const n=JSON.parse(o);if(n?.id===k.value){s.value=n;return}}catch{}const l=await R({category:"desktop",page:1,pageSize:48});s.value=l.list.find(n=>n.id===k.value)||null},L=()=>{window.history.length>1?C.back():C.push("/wallpapers")},T=()=>{s.value&&window.open(s.value.url,"_blank")},V=()=>{if(!s.value)return;const o=new Set(b.value);o.has(s.value.id)?o.delete(s.value.id):o.add(s.value.id),b.value=o},D=async()=>{if(s.value)try{await navigator.clipboard.writeText(s.value.url),w.value=!0,window.setTimeout(()=>w.value=!1,900)}catch{}},E=o=>{try{window.sessionStorage.setItem(U,JSON.stringify(o))}catch{}},O=p(()=>s.value?b.value.has(s.value.id):!1),d=m([]),x=m(!1),G=async()=>{if(s.value){x.value=!0;try{const o=s.value.tags?.[0],n=(await R({category:"desktop",page:1,pageSize:36,keyword:o||void 0})).list.filter(r=>r.id!==s.value?.id),e=[],c=24;if(n.length===0){d.value=[];return}for(let r=0;r<Math.min(n.length,c);r++)e.push(n[r]);for(;e.length<c;)e.push(n[e.length%n.length]);d.value=e}finally{x.value=!1}}},S=p(()=>s.value?.tags||[]),z=["北风","小羊星冰乐","云端收藏","星河漫游","夜航船","猫猫仓库"],J=p(()=>{const o=d.value,l=[],n=6;for(let e=0;e<n;e++){const c=e*4,r=o.slice(c,c+4),M=z[e%z.length]??"收藏",j=r[1]?.thumbUrl||r[0]?.thumbUrl||"";l.push({id:`col_${e}`,name:M,items:r,avatarUrl:j})}return l});return K(k,async()=>{s.value=null,d.value=[],await I(),await G()},{immediate:!0}),(o,l)=>{const n=Y("RouterLink");return a(),i("div",Z,[t("div",tt,[t("div",et,[t("button",{type:"button",class:"btn btn-outline-secondary btn-sm",onClick:L},[g(_,{name:"ri-arrow-left-line",size:18}),l[0]||(l[0]=h(" 返回 ",-1))]),s.value?(a(),i("div",st,v(s.value.title),1)):u("",!0)]),s.value?(a(),i("div",lt,[t("div",at,[t("div",ot,[t("img",{class:"preview-img",src:s.value.url,alt:s.value.title},null,8,it)]),t("div",nt,[l[1]||(l[1]=t("div",{class:"section-title"},"相关标签",-1)),S.value.length?(a(),i("div",ct,[(a(!0),i(y,null,f(S.value,e=>(a(),i("span",{key:e,class:"tag-pill"},v(e),1))),128))])):(a(),i("div",rt,"暂无标签"))])]),t("div",dt,[t("div",ut,[t("div",vt,[t("div",mt,v(s.value.title),1),t("div",_t,[t("span",null,v(B(s.value.width,s.value.height)),1),l[2]||(l[2]=t("span",{class:"mx-2"},"·",-1)),t("span",null,v(F(s.value.width,s.value.height)),1)])]),t("div",pt,[t("button",{type:"button",class:"action-btn",onClick:T},[g(_,{name:"ri-download-2-line",size:18}),l[3]||(l[3]=h(" 下载 ",-1))]),t("button",{type:"button",class:"action-btn",onClick:V},[g(_,{name:O.value?"ri-heart-3-fill":"ri-heart-3-line",size:18},null,8,["name"]),l[4]||(l[4]=h(" 收藏 ",-1))]),t("button",{type:"button",class:"action-btn",onClick:D},[g(_,{name:w.value?"ri-check-line":"ri-link",size:18},null,8,["name"]),l[5]||(l[5]=h(" 复制 ",-1))])]),l[6]||(l[6]=t("div",{class:"desc mt-2"},[t("div",{class:"desc-title mb-2"},"描述"),t("div",{class:"desc-body mb-2"},"悄悄做个梦给你~"),t("div",{class:"desc-body"},"又怕做梦梦到你~")],-1))]),t("div",gt,[l[7]||(l[7]=t("div",{class:"section-title"},"相关推荐",-1)),x.value?(a(),i("div",ht,"加载中...")):d.value.length?(a(),i("div",yt,[(a(!0),i(y,null,f(d.value.filter((e,c)=>c<12),e=>(a(),$(n,{key:e.id,class:"rec-item",to:`/wallpapers/${e.id}`,onClick:c=>E(e)},{default:W(()=>[t("img",{class:"rec-img",src:e.thumbUrl,alt:e.title,loading:"lazy"},null,8,ft)]),_:2},1032,["to","onClick"]))),128))])):(a(),i("div",kt,"暂无推荐"))])])])):u("",!0),s.value?(a(),i("div",bt,[l[8]||(l[8]=t("div",{class:"section-title"},"相关收藏",-1)),t("div",wt,[(a(!0),i(y,null,f(J.value,e=>(a(),i("div",{key:e.id,class:H(["collection-card",{empty:!e.items.length}])},[t("div",xt,[(a(!0),i(y,null,f(e.items,c=>(a(),i("div",{key:`c_${e.id}_${c.id}`,class:"collage-cell"},[t("img",{class:"collage-img",src:c.thumbUrl,alt:c.title,loading:"lazy"},null,8,Ct)]))),128)),e.items.length?u("",!0):(a(),i("div",St," 暂无收藏 "))]),t("div",zt,[t("div",{class:"avatar-ring",style:Q(e.avatarUrl?{backgroundImage:`url(${e.avatarUrl})`}:void 0)},[e.avatarUrl?u("",!0):(a(),$(_,{key:0,name:"ri-user-3-line",size:18}))],4)]),t("div",$t,v(e.name),1)],2))),128))])])):u("",!0),s.value?u("",!0):(a(),i("div",Rt,"未找到该壁纸（mock）"))])])}}}),Lt=X(Ut,[["__scopeId","data-v-1f7e7067"]]);export{Lt as default};
