import{d as E,b as l,t as y,n as B,f as w,F as A,j as F,e as a,s as T,g as m,_ as M,h as U,p as n,q as O,r as f,c as S,u as j,o as W,a as J,x as Z,l as H,T as ee,y as te,z as ae,A as v}from"./index-BwwhmSGQ.js";import{r as I}from"./request-C7OBr44B.js";const oe={class:"list-shell"},se={key:0,class:"alert alert-danger mb-0",role:"alert"},ne={key:0,class:"empty text-secondary"},le=["href"],re={class:"grid-media"},ie=["src","alt"],ce={key:1,class:"cover cover-fallback"},de={class:"badge badge-cat"},ue={key:2,class:"badge badge-q"},ve={class:"grid-body"},ge={class:"grid-title text-truncate"},pe={class:"grid-desc text-truncate"},me={key:0},he={class:"grid-foot"},ye={class:"grid-meta"},fe={key:0,class:"m"},_e={key:1,class:"m"},be={key:0,class:"size"},we={class:"grid-actions"},ke=["onClick"],Me=["href"],xe=["href"],Ce={class:"row-cover"},ze=["src","alt"],Se={key:1,class:"cover cover-fallback"},$e={class:"badge badge-cat"},Ve={class:"row-body"},Pe={class:"row-title text-truncate"},Re={class:"row-desc text-truncate"},Ue={key:0},Le={class:"row-foot"},Te={class:"row-meta"},Be={key:0},Ee={key:1},Oe={key:2},De={class:"row-actions"},Ne=["onClick"],qe=["href"],Ae=E({__name:"ResourceResultList",props:{list:{},loading:{type:Boolean},loadingMore:{type:Boolean},hasMore:{type:Boolean},errorMsg:{},sort:{},viewMode:{}},emits:["changeSort","loadMore"],setup(o,{emit:s}){async function c(d){try{await navigator.clipboard.writeText(d)}catch{return}}return(d,i)=>(n(),l("div",oe,[o.errorMsg?(n(),l("div",se,y(o.errorMsg),1)):(n(),l("div",{key:1,class:B(["list-body",o.viewMode==="grid"?"grid":"list"])},[!o.list.length&&!o.loading?(n(),l("div",ne," 暂无数据 ")):w("",!0),o.viewMode==="grid"?(n(!0),l(A,{key:1},F(o.list,e=>(n(),l("a",{key:e.id,class:"grid-card",href:e.extractedUrl,target:"_blank",rel:"noreferrer"},[a("div",re,[e.coverUrl?(n(),l("img",{key:0,class:"cover",src:e.coverUrl,alt:e.title,loading:"lazy"},null,8,ie)):(n(),l("div",ce)),a("div",de,y(e.category),1),e.qualityTag?(n(),l("div",ue,y(e.qualityTag),1)):w("",!0)]),a("div",ve,[a("div",ge,y(e.title),1),a("div",pe,[T(y(e.source||"未知来源")+" ",1),e.updatedAt?(n(),l("span",me," · "+y(e.updatedAt),1)):w("",!0)]),a("div",he,[a("div",ye,[e.views?(n(),l("span",fe,[m(M,{name:"ri-eye-line",size:14}),T(" "+y(e.views),1)])):w("",!0),typeof e.rating=="number"?(n(),l("span",_e,[m(M,{name:"ri-star-fill",size:14}),T(" "+y(e.rating.toFixed(1)),1)])):w("",!0)]),e.size?(n(),l("div",be,y(e.size),1)):w("",!0),a("div",we,[a("button",{class:"icon-btn",type:"button",title:"复制链接",onClick:U(u=>c(e.extractedUrl),["prevent","stop"])},[m(M,{name:"ri-link",size:16})],8,ke),e.downloadUrl?(n(),l("a",{key:0,class:"icon-btn",title:"下载",href:e.downloadUrl,target:"_blank",rel:"noreferrer",onClick:i[0]||(i[0]=U(()=>{},["stop"]))},[m(M,{name:"ri-download-2-line",size:16})],8,Me)):w("",!0)])])])],8,le))),128)):(n(!0),l(A,{key:2},F(o.list,e=>(n(),l("a",{key:e.id,class:"row-card",href:e.extractedUrl,target:"_blank",rel:"noreferrer"},[a("div",Ce,[e.coverUrl?(n(),l("img",{key:0,class:"cover",src:e.coverUrl,alt:e.title,loading:"lazy"},null,8,ze)):(n(),l("div",Se)),a("div",$e,y(e.category),1)]),a("div",Ve,[a("div",Pe,y(e.title),1),a("div",Re,[T(y(e.source||"未知来源")+" ",1),e.updatedAt?(n(),l("span",Ue," · "+y(e.updatedAt),1)):w("",!0)]),a("div",Le,[a("div",Te,[e.views?(n(),l("span",Be,[m(M,{name:"ri-eye-line",size:14}),T(" "+y(e.views),1)])):w("",!0),typeof e.rating=="number"?(n(),l("span",Ee,[m(M,{name:"ri-star-fill",size:14}),T(" "+y(e.rating.toFixed(1)),1)])):w("",!0),e.size?(n(),l("span",Oe,y(e.size),1)):w("",!0)]),a("div",De,[a("button",{class:"icon-btn",type:"button",title:"复制链接",onClick:U(u=>c(e.extractedUrl),["prevent","stop"])},[m(M,{name:"ri-link",size:16})],8,Ne),e.downloadUrl?(n(),l("a",{key:0,class:"icon-btn",title:"下载",href:e.downloadUrl,target:"_blank",rel:"noreferrer",onClick:i[1]||(i[1]=U(()=>{},["stop"]))},[m(M,{name:"ri-download-2-line",size:16})],8,qe)):w("",!0)])])])],8,xe))),128))],2))]))}}),Fe=O(Ae,[["__scopeId","data-v-6e41f806"]]),Ie=["disabled"],We={class:"pd-text"},He=["onClick"],Ge={class:"pd-opt-text"},je=E({__name:"PortalDropdown",props:{modelValue:{},options:{},disabled:{type:Boolean,default:!1},minWidth:{default:0}},emits:["update:modelValue"],setup(o,{emit:s}){const c=o,d=s,i=f(!1),e=f(null),u=f(null);let x=null;const L=S(()=>c.options.find(p=>p.value===c.modelValue)?.label??""),P=S(()=>{const p=c.minWidth||0;return p>0?{"--pd-minw":`${p}px`}:void 0}),C=()=>{c.disabled||(i.value=!i.value)},$=()=>{i.value=!1},_=p=>{d("update:modelValue",p),$()},t=p=>{if(!i.value)return;const b=p.target;b&&(e.value&&e.value.contains(b)||u.value&&u.value.contains(b)||$())},r=p=>{i.value&&p.key==="Escape"&&$()},g=async()=>{if(await te(),!i.value)return;const p=e.value,b=u.value;!p||!b||(x?x.update():x=ae(p,b,{placement:"bottom-start",strategy:"fixed",modifiers:[{name:"offset",options:{offset:[0,8]}},{name:"flip",options:{fallbackPlacements:["top-start","bottom-end","top-end"]}},{name:"preventOverflow",options:{padding:8}}]}))},V=()=>{try{x?.destroy()}catch{}x=null};return j(()=>i.value,async p=>{p?await g():V()}),W(()=>{window.addEventListener("click",t),window.addEventListener("keydown",r)}),J(()=>{window.removeEventListener("click",t),window.removeEventListener("keydown",r),V()}),(p,b)=>(n(),l("div",{ref_key:"anchorRef",ref:e,class:"pd",style:Z(P.value)},[a("button",{type:"button",class:"pd-btn",disabled:o.disabled,onClick:U(C,["stop"])},[a("span",We,y(L.value),1),m(M,{name:"ri-arrow-down-s-line",class:"pd-caret"})],8,Ie),(n(),H(ee,{to:"body"},[i.value?(n(),l("div",{key:0,ref_key:"popRef",ref:u,class:"pd-pop",role:"menu",onClick:b[0]||(b[0]=U(()=>{},["stop"]))},[(n(!0),l(A,null,F(o.options,k=>(n(),l("button",{key:k.value,type:"button",class:B(["pd-opt",{active:k.value===o.modelValue}]),role:"menuitem",onClick:D=>_(k.value)},[a("span",Ge,y(k.label),1),k.value===o.modelValue?(n(),H(M,{key:0,name:"ri-check-line",class:"pd-check"})):w("",!0)],10,He))),128))],512)):w("",!0)]))],4))}}),q=O(je,[["__scopeId","data-v-c3f2d990"]]),Je={class:"pager",role:"navigation","aria-label":"分页"},Ke={class:"pager-left"},Qe=["disabled"],Xe=["disabled","onClick"],Ye=["disabled"],Ze={class:"ps"},et=E({__name:"ResourcePagination",props:{page:{},pageSize:{},total:{}},emits:["change","changePageSize"],setup(o,{emit:s}){const c=o,d=s,i=[10,20,50,100],e=S(()=>{const t=Math.max(1,c.pageSize||1),r=Math.max(0,c.total||0);return Math.max(1,Math.ceil(r/t))}),u=S(()=>{const t=e.value,r=Math.min(Math.max(1,c.page||1),t);if(t<=10)return Array.from({length:t},(k,D)=>D+1);const g=[],V=k=>{g.length&&g[g.length-1]==="…"&&k==="…"||g.push(k)};V(1);const p=Math.max(2,r-2),b=Math.min(t-1,r+2);p>2&&V("…");for(let k=p;k<=b;k++)V(k);return b<t-1&&V("…"),V(t),g}),x=S(()=>(c.page||1)>1),L=S(()=>(c.page||1)<e.value),P=t=>{const r=e.value,g=Math.min(Math.max(1,t),r);g!==c.page&&d("change",g)},C=S(()=>i.map(t=>({value:String(t),label:`${t}/页`}))),$=S(()=>String(c.pageSize||i[0])),_=t=>{const r=Number(t);!Number.isFinite(r)||r<=0||r!==c.pageSize&&d("changePageSize",r)};return(t,r)=>(n(),l("div",Je,[a("div",Ke,[a("button",{class:"nav",type:"button",disabled:!x.value,onClick:r[0]||(r[0]=g=>P(o.page-1))}," ‹ ",8,Qe),(n(!0),l(A,null,F(u.value,g=>(n(),l("button",{key:String(g),class:B(["p",{active:g===o.page}]),type:"button",disabled:g==="…",onClick:V=>typeof g=="number"&&P(g)},y(g),11,Xe))),128)),a("button",{class:"nav",type:"button",disabled:!L.value,onClick:r[1]||(r[1]=g=>P(o.page+1))}," › ",8,Ye),a("div",Ze,[m(q,{modelValue:$.value,options:C.value,minWidth:86,"onUpdate:modelValue":_},null,8,["modelValue","options"])])])]))}}),tt=O(et,[["__scopeId","data-v-57e091aa"]]),at={class:"hero"},ot={class:"hero-title"},st={class:"hero-ico"},nt={class:"search-pill"},lt=["value","disabled"],rt=["disabled"],it={class:"filters-row"},ct={class:"filters-left"},dt={class:"filters-right"},ut={class:"view seg",role:"group","aria-label":"视图切换"},vt=E({__name:"ResourceSearchHero",props:{keyword:{},loading:{type:Boolean},categories:{},activeCategory:{},sort:{},viewMode:{}},emits:["update:keyword","search","changeCategory","changeSort","toggleView"],setup(o,{emit:s}){const c=o,d=s;function i(){d("search")}const e=f(!1),u=f(null),x=_=>{if(!e.value)return;const t=_.target;t&&(u.value&&u.value.contains(t)||(e.value=!1))};W(()=>{window.addEventListener("click",x)}),J(()=>{window.removeEventListener("click",x)});const L=S(()=>{const _=c.categories||[];return _.length?_:[{key:"all",name:"全部"}]}),P=S(()=>L.value.map(_=>({value:_.key,label:_.name}))),C=[{value:"latest",label:"全部时间"},{value:"hot",label:"相关度"},{value:"all",label:"全网搜"}],$=[{value:"all",label:"全部大小"}];return(_,t)=>(n(),l("div",at,[a("div",ot,[a("span",st,[m(M,{name:"ri-search-2-line",size:18})]),t[7]||(t[7]=a("span",null,"资源搜索",-1))]),a("form",{class:"search-row",onSubmit:U(i,["prevent"])},[a("div",nt,[a("input",{class:"ipt",value:o.keyword,disabled:o.loading,placeholder:"搜索电影、音乐、软件、文档等资源...",onInput:t[0]||(t[0]=r=>d("update:keyword",r.target.value))},null,40,lt),a("button",{class:"search-btn",type:"submit",disabled:o.loading},[m(M,{name:"ri-search-line",size:16}),t[8]||(t[8]=T(" 搜索资源 ",-1))],8,rt)])],32),a("div",it,[a("div",ct,[m(q,{modelValue:o.activeCategory,options:P.value,disabled:!!o.loading,minWidth:96,"onUpdate:modelValue":t[1]||(t[1]=r=>d("changeCategory",r))},null,8,["modelValue","options","disabled"]),m(q,{modelValue:o.sort,options:C,disabled:!!o.loading,minWidth:96,"onUpdate:modelValue":t[2]||(t[2]=r=>d("changeSort",r))},null,8,["modelValue","options","disabled"]),m(q,{modelValue:"all",options:$,disabled:"",minWidth:96,"onUpdate:modelValue":()=>{}})]),a("div",dt,[a("div",{ref_key:"extraRef",ref:u,class:"extra"},[a("button",{type:"button",class:"extra-btn",onClick:t[3]||(t[3]=U(r=>e.value=!e.value,["stop"]))},[m(M,{name:"ri-filter-3-line",size:16}),t[9]||(t[9]=T(" 高级筛选 ",-1))]),e.value?(n(),l("div",{key:0,class:"extra-pop",onClick:t[4]||(t[4]=U(()=>{},["stop"]))},[...t[10]||(t[10]=[a("div",{class:"extra-item"},"暂未接入更多筛选条件",-1)])])):w("",!0)],512),a("div",ut,[a("button",{type:"button",class:B(["view-btn seg-btn",{active:o.viewMode==="grid"}]),onClick:t[5]||(t[5]=r=>d("toggleView","grid")),title:"网格"},[m(M,{name:"ri-grid-fill",size:16})],2),a("button",{type:"button",class:B(["view-btn seg-btn",{active:o.viewMode==="list"}]),onClick:t[6]||(t[6]=r=>d("toggleView","list")),title:"列表"},[m(M,{name:"ri-list-check",size:16})],2)])])])]))}}),gt=O(vt,[["__scopeId","data-v-6c81f146"]]);async function pt(){return I({url:"/resources/categories",method:"get"})}async function G(o){return I({url:"/resources/search",method:"get",params:o})}async function mt(){return I({url:"/resources/hot/daily",method:"get"})}async function ht(){return I({url:"/resources/hot/recommend",method:"get"})}function yt(){const o=f(""),s=f("all"),c=f("latest"),d=f(1),i=f(10),e=f(0),u=f([]),x=f([]),L=f([]),P=f([]),C=f(!1),$=f(!1),_=f(null),t=f(0),r=S(()=>u.value.length<e.value),g=S(()=>{const h=Math.max(1,i.value||1),z=Math.max(0,e.value||0);return Math.max(1,Math.ceil(z/h))}),V=async()=>{const h=await pt();x.value=h.data.list},p=async()=>{const[h,z]=await Promise.all([mt(),ht()]);L.value=h.data.list,P.value=z.data.list},b=async(h=!1)=>{if(C.value||!h&&!r.value&&u.value.length>0)return;const z=++t.value;_.value=null,h?C.value=!0:($.value=!0,d.value+=1);try{const R=await G({keyword:o.value.trim()||void 0,category:s.value,sort:c.value,page:d.value,pageSize:i.value});if(z!==t.value)return;e.value=R.data.total,d.value=R.data.page,i.value=R.data.pageSize,h?u.value=R.data.list:u.value=[...u.value,...R.data.list]}catch{z===t.value&&(_.value="加载失败，请稍后重试")}finally{z===t.value&&(C.value=!1,$.value=!1)}},k=async h=>{typeof h=="string"&&(o.value=h),d.value=1,await b(!0)},D=async h=>{const z=Math.min(Math.max(1,h),g.value);if(z===d.value||C.value)return;d.value=z,C.value=!0;const R=++t.value;_.value=null;try{const N=await G({keyword:o.value.trim()||void 0,category:s.value,sort:c.value,page:d.value,pageSize:i.value});if(R!==t.value)return;e.value=N.data.total,d.value=N.data.page,i.value=N.data.pageSize,u.value=N.data.list}catch{R===t.value&&(_.value="加载失败，请稍后重试")}finally{R===t.value&&(C.value=!1)}},K=async h=>{s.value=h},Q=async h=>{c.value=h},X=async()=>{await b(!1)},Y=async h=>{const z=Math.max(1,Math.floor(h||1));z!==i.value&&(i.value=z,d.value=1,await b(!0))};return j(()=>[s.value,c.value],async()=>{d.value=1,await b(!0)}),W(async()=>{await Promise.all([V(),p()]),await b(!0)}),{keyword:o,category:s,sort:c,page:d,pageSize:i,total:e,list:u,categories:x,hotDaily:L,hotRecommend:P,loading:C,loadingMore:$,errorMsg:_,hasMore:r,totalPages:g,onSearch:k,onChangeCategory:K,onChangeSort:Q,onLoadMore:X,goPage:D,setPageSize:Y}}const ft={class:"container-fluid py-3 portal-page"},_t={class:"hero-wrap"},bt={class:"summary-row"},wt={class:"summary-left"},kt={class:"summary-right"},Mt={key:0,class:"text-secondary small"},xt=E({__name:"index",setup(o){const s=yt(),c=f("grid"),d=S(()=>`找到 ${s.total.value.toLocaleString()} 条结果`);return(i,e)=>(n(),l("div",ft,[a("div",_t,[m(gt,{keyword:v(s).keyword.value,loading:v(s).loading.value,categories:v(s).categories.value,activeCategory:v(s).category.value,sort:v(s).sort.value,viewMode:c.value,"onUpdate:keyword":e[0]||(e[0]=u=>v(s).keyword.value=u),onSearch:e[1]||(e[1]=u=>v(s).onSearch()),onChangeCategory:v(s).onChangeCategory,onChangeSort:v(s).onChangeSort,onToggleView:e[2]||(e[2]=u=>c.value=u)},null,8,["keyword","loading","categories","activeCategory","sort","viewMode","onChangeCategory","onChangeSort"])]),e[3]||(e[3]=a("div",{class:"divider"},null,-1)),a("div",bt,[a("div",wt,y(d.value),1),a("div",kt,[v(s).loading.value?(n(),l("span",Mt,"加载中...")):w("",!0)])]),m(Fe,{list:v(s).list.value,loading:v(s).loading.value,loadingMore:v(s).loadingMore.value,hasMore:v(s).hasMore.value,errorMsg:v(s).errorMsg.value||"",sort:v(s).sort.value,viewMode:c.value,onChangeSort:v(s).onChangeSort,onLoadMore:v(s).onLoadMore},null,8,["list","loading","loadingMore","hasMore","errorMsg","sort","viewMode","onChangeSort","onLoadMore"]),m(tt,{page:v(s).page.value,pageSize:v(s).pageSize.value,total:v(s).total.value,onChange:v(s).goPage,onChangePageSize:v(s).setPageSize},null,8,["page","pageSize","total","onChange","onChangePageSize"])]))}}),St=O(xt,[["__scopeId","data-v-6ad04f4f"]]);export{St as default};
